<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesys Widget Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
        }
        
        .debug-panel {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .error {
            color: #f00;
        }
        
        .success {
            color: #0f0;
        }
        
        .info {
            color: #ff0;
        }
        
        #genesys-support-center {
            min-height: 500px;
            border: 2px dashed #ccc;
            background: white;
            border-radius: 8px;
            padding: 20px;
        }
        
        .placeholder {
            text-align: center;
            color: #666;
            padding: 100px 20px;
        }
        
        .test-buttons {
            margin: 20px 0;
        }
        
        .test-buttons button {
            background: #1e5ba8;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Genesys Widget Styling */
        #genesys-support-center {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        }

        #genesys-support-center [class*="hero"],
        #genesys-support-center [class*="header"],
        #genesys-support-center [class*="banner"] {
            background: linear-gradient(135deg, #1e5ba8 0%, #2980b9 100%) !important;
            color: white !important;
            padding: 60px 20px !important;
            text-align: center !important;
        }

        #genesys-support-center h1 {
            color: white !important;
            font-size: 48px !important;
            font-weight: 300 !important;
            margin-bottom: 30px !important;
        }

        #genesys-support-center input[type="text"],
        #genesys-support-center input[type="search"] {
            width: 100% !important;
            max-width: 500px !important;
            padding: 15px 20px !important;
            border: none !important;
            border-radius: 25px !important;
            font-size: 16px !important;
            background: white !important;
            margin: 0 auto !important;
            display: block !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1) !important;
        }

        #genesys-support-center [class*="card"] {
            background: white !important;
            padding: 30px 20px !important;
            border-radius: 8px !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05) !important;
            border: 1px solid #e1e5e9 !important;
            text-align: center !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
        }

        #genesys-support-center [class*="card"]:hover {
            transform: translateY(-5px) !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
        }
    </style>
</head>
<body>
    <h1>Genesys Widget Debug Page</h1>
    
    <div class="debug-panel" id="debug-log">
        <div>üîç Starting Genesys widget debugging...</div>
    </div>
    
    <div class="test-buttons">
        <button onclick="testMethod1()">Test Method 1 (Original)</button>
        <button onclick="testMethod2()">Test Method 2 (Alternative CDN)</button>
        <button onclick="testMethod3()">Test Method 3 (Different Environment)</button>
        <button onclick="clearWidget()">Clear Widget</button>
    </div>
    
    <div id="genesys-support-center">
        <div class="placeholder">
            üîÑ Waiting for Genesys widget to load...
        </div>
    </div>
    
    <script>
        let debugLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            debugLog.push({message: logEntry, type});
            
            const logPanel = document.getElementById('debug-log');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = logEntry;
            logPanel.appendChild(div);
            logPanel.scrollTop = logPanel.scrollHeight;
            
            console.log(logEntry);
        }
        
        function clearWidget() {
            document.getElementById('genesys-support-center').innerHTML = '<div class="placeholder">üîÑ Widget cleared. Click a test method to try again.</div>';
            log('Widget cleared', 'info');
        }
        
        function waitForWidget(method) {
            let attempts = 0;
            const maxAttempts = 30;
            
            const checkWidget = () => {
                attempts++;
                const widget = document.querySelector('#genesys-support-center');
                
                if (widget && widget.children.length > 1) {
                    log(`‚úÖ Widget loaded successfully with method ${method}!`, 'success');
                    return;
                }
                
                if (attempts >= maxAttempts) {
                    log(`‚ùå Widget failed to load after ${maxAttempts} attempts with method ${method}`, 'error');
                    return;
                }
                
                setTimeout(checkWidget, 1000);
            };
            
            setTimeout(checkWidget, 2000);
        }
        
        // Method 1: Original deployment
        function testMethod1() {
            log('üß™ Testing Method 1: Original Genesys deployment', 'info');
            clearWidget();
            
            (function (g, e, n, es, ys) {
                g['_genesysJs'] = e;
                g[e] = g[e] || function () {
                    (g[e].q = g[e].q || []).push(arguments)
                };
                g[e].t = 1 * new Date();
                g[e].c = es;
                ys = document.createElement('script'); 
                ys.async = 1; 
                ys.src = n; 
                ys.charset = 'utf-8';
                
                ys.onload = function() {
                    log('‚úÖ Method 1: Genesys script loaded', 'success');
                };
                
                ys.onerror = function() {
                    log('‚ùå Method 1: Script failed to load', 'error');
                };
                
                document.head.appendChild(ys);
            })(window, 'Genesys', 'https://apps.usw2.pure.cloud/genesys-bootstrap/genesys.min.js', {
                environment: 'prod-usw2',
                deploymentId: 'f5dcfe55-e3b6-4d5c-bcfb-5d40300125e3'
            });
            
            waitForWidget(1);
        }
        
        // Method 2: Alternative CDN
        function testMethod2() {
            log('üß™ Testing Method 2: Alternative CDN approach', 'info');
            clearWidget();
            
            // Using the standard Genesys Widgets approach
            if(!window._genesys) window._genesys = {};
            if(!window._gt) window._gt = [];
            
            window._genesys.widgets = {
                main: {
                    debug: true,
                    theme: 'light',
                    lang: 'en'
                },
                webchat: {
                    userData: {},
                    autoInvite: {
                        enabled: false
                    }
                }
            };
            
            const script = document.createElement('script');
            script.src = 'https://apps.mypurecloud.com/widgets/9.0/cxbus.min.js';
            script.onload = function() {
                log('‚úÖ Method 2: Alternative script loaded', 'success');
                if (window.CXBus) {
                    window.CXBus.configure({
                        debug: true,
                        pluginsPath: 'https://apps.mypurecloud.com/widgets/9.0/plugins/'
                    });
                }
            };
            script.onerror = function() {
                log('‚ùå Method 2: Alternative script failed', 'error');
            };
            
            document.head.appendChild(script);
            waitForWidget(2);
        }
        
        // Method 3: Different environment
        function testMethod3() {
            log('üß™ Testing Method 3: Different environment', 'info');
            clearWidget();
            
            (function (g, e, n, es, ys) {
                g['_genesysJs'] = e;
                g[e] = g[e] || function () {
                    (g[e].q = g[e].q || []).push(arguments)
                };
                g[e].t = 1 * new Date();
                g[e].c = es;
                ys = document.createElement('script'); 
                ys.async = 1; 
                ys.src = n; 
                ys.charset = 'utf-8';
                
                ys.onload = function() {
                    log('‚úÖ Method 3: Script loaded', 'success');
                };
                
                ys.onerror = function() {
                    log('‚ùå Method 3: Script failed to load', 'error');
                };
                
                document.head.appendChild(ys);
            })(window, 'Genesys', 'https://apps.mypurecloud.com/genesys-bootstrap/genesys.min.js', {
                environment: 'mypurecloud.com',
                deploymentId: 'f5dcfe55-e3b6-4d5c-bcfb-5d40300125e3'
            });
            
            waitForWidget(3);
        }
        
        // Check if we're on localhost or need domain fix
        if (location.hostname === 'localhost' || location.hostname.indexOf('.') === -1) {
            log('‚ö†Ô∏è Warning: You may need a proper domain name for Genesys widgets to work', 'error');
        }
        
        // Check for common blocking issues
        log('üîç Current domain: ' + location.hostname, 'info');
        log('üîç Protocol: ' + location.protocol, 'info');
        
        // Auto-start with method 1
        setTimeout(() => {
            log('üöÄ Auto-starting with Method 1...', 'info');
            testMethod1();
        }, 1000);
    </script>
</body>
</html>
